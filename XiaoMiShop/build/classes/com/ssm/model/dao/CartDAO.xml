<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssm.model.dao.CartDAO">
   
    <!-- 获取整个购物车 -->
    
    <select id="searchCart" parameterType="String" resultMap="cartinfo">
    	select * from cartinfo
    	where user_email=#{user_email}
    </select>
    
    <resultMap type="Cart" id="cartinfo">
    	<result property="cart_id" column="cart_id"/>
    	<result property="user_email" column="user_email"/>
    	<result property="goods_num" column="goods_num"/>
    	<association property="goodsdetail" column="goods_detil_id" javaType="GoodsDetail" resultMap="goodsDetailQuery"/>
    </resultMap>
    
    <resultMap type="GoodsDetail" id="goodsDetailQuery">
    	<result property="goods_detail_id" column="goods_detail_id"/>
    	<result property="goods_id" column="goods_id"/>
    	<result property="kind" column="kind"/>
    	<result property="color" column="color"/>
    	<result property="prime_price" column="prime_price"/>
    	<result property="discount_price" column="discount_price"/>
    	<result property="stock" column="stock"/>
    	<result property="goods_detail_status" column="goods_detail_status"/>
    	<association property="goods" column="goods_id" javaType="Goods" resultMap="goodsQuery"/>
    	<collection property="goodsPictureList" ofType="GoodsPicture">
    		<result property="picture_set_id" column="picture_set_id"/>
    		<result property="goods_detail_id" column="goods_detail_id"/>
    		<result property="picture_set_url" column="picture_set_url"/>
    		<result property="picture_set_status" column="picture_set_status"/>
    	</collection>
    </resultMap>
    
    <resultMap type="Goods" id="goodsQuery">
    	<result property="goods_id" column="goods_id"/>
    	<result property="goods_category_id" column="goods_category_id"/>
    	<result property="goods_code" column="goods_code"/>
    	<result property="goods_name" column="goods_name"/>
    	<result property="video_set_url" column="video_set_url"/>
    </resultMap>
    
    
    
    

    
    <!-- 删除条目 -->
    <delete id="deleteItem" >
         delete from  cart 
         where cart_id in 
         <!-- froeach实现遍历
         	collection：要遍历的元素类型
         	item:当前遍历到的元素
         	open:遍历的结果以什么字符开始
         	close：遍历的结果以什么字符结束
         	separator:分隔符
          -->
         <foreach collection="array"  item="item"   open="(" 
              separator=","  close=")"   >
             #{item}
         </foreach>
     </delete>
    
    

    <!-- 增加数量 -->
    
     <update id="updateAddNum" parameterType="int" >
         update cart 
         set goods_num=goods_num+1
         where cart_id=#{cartid}
     </update>
    
    
    <!-- 减少数量 -->
     <update id="updateSubNum" parameterType="int" >
         update cart 
         set goods_num=goods_num-1
         where cart_id=#{cartid}
     </update>
    <!-- 清空购物车 -->
    <delete id="deleteAll" parameterType="String">
  	    delete from cart
  	    where user_email=#{email}
  	</delete>
    
    	
    <!-- 查找库存 -->
    
    <select id="findInStock" parameterType="int" resultType="int">
    	select stock from goods_detail
    	where goods_detail_id=#{goods_detail_id}
    </select>
    
   
</mapper>